# LLM Assistant for Obsidian

Obsidian上でLLM（大規模言語モデル）を活用し、ノート執筆支援やVault内ファイルの理解を行うプラグインです。

**モバイルファースト設計** — iPhone / iPad / Mac / Windows / Android の全プラットフォームで動作します。

---

## 概要

既存のObsidian向けLLMプラグインの多くは、機能過多でUIが煩雑になり、プロンプト入力画面や出力結果の表示スペースが狭いという課題がありました。また、iPhoneやiPadでは動作しないプラグインも少なくありません。

LLM Assistantは以下の方針で設計されています:

- 広い入出力スペースを確保したシンプルなチャットUI
- 全プラットフォーム（iPhone/iPad/Mac/Windows/Android）での動作保証
- 複数のLLMプロバイダーに対応（APIキーがあればすぐに使える）
- API鍵の安全な保管（SecretStorage / WebCrypto暗号化）

---

## 機能一覧

- **チャットUI** — ストリーミング対応のリアルタイム表示、Markdownレンダリング
- **マルチプロバイダー対応** — 6種類のLLMプロバイダーをヘッダーのセレクタで切り替え
- **ノート添付コンテキスト** — Vault内のノートをコンテキストとしてLLMに送信（トークンカウント表示付き）
- **クイックアクション** — エディタの右クリックメニューから選択テキストを要約・翻訳・校正・解説・展開
- **会話履歴** — 会話の自動保存・一覧表示・再開・削除
- **システムプロンプトプリセット** — 丁寧な日本語アシスタント、テクニカルライター、翻訳者など6種類
- **セキュアなAPI鍵管理** — SecretStorage API / WebCrypto暗号化 / 平文の3段階から選択
- **レスポンシブデザイン** — スマートフォン・タブレット・デスクトップそれぞれに最適化

---

## 対応LLMプロバイダー

| プロバイダー | モデル例 | APIキー | ストリーミング | 備考 |
|:---|:---|:---:|:---:|:---|
| **OpenAI** | GPT-5, GPT-5.2 | 必要 | 対応 | |
| **Anthropic** | Claude Opus 4.6, Sonnet 4.5, Haiku 4.5 | 必要 | 段階描画 | CORS非対応のためrequestUrl()使用 |
| **Google Gemini** | Gemini 3.0 Flash, 3.0 Pro | 必要 | 対応 | |
| **OpenRouter** | Claude, GPT, Llama, DeepSeek等 | 必要 | 対応 | 複数プロバイダーのモデルを統合アクセス |
| **Ollama** | Llama 3.3, Gemma 3, Qwen 3 等 | 不要 | 対応 | デスクトップ専用、ローカル実行 |
| **カスタム** | ユーザー指定 | 任意 | 対応 | OpenAI互換APIの任意URLに接続 |

---

## 動作要件

- **Obsidian** v1.11.4 以上
- 各プロバイダーの**APIキー**（Ollamaを除く）
- Ollamaを使用する場合は、デスクトップ環境に[Ollama](https://ollama.com/)がインストールされていること

---

## 入手方法

### 方法1: Obsidianコミュニティプラグイン（公開後）

> 現在コミュニティプラグインへの申請は未実施です。公開後はこの方法が最も簡単です。

1. Obsidianの **設定** を開く
2. **コミュニティプラグイン** → **閲覧** をクリック
3. 「LLM Assistant」を検索
4. **インストール** をクリック

### 方法2: BRAT経由（ベータテスト用）

[BRAT（Beta Reviewer's Auto-update Tool）](https://github.com/TfTHacker/obsidian42-brat) を使えば、コミュニティプラグインに未登録のプラグインもインストールできます。

1. Obsidianのコミュニティプラグインから **BRAT** をインストール・有効化
2. コマンドパレット（`Ctrl/Cmd + P`）を開き、「BRAT: Add a beta plugin for testing」を実行
3. リポジトリURL `m0370/obsidian-LLM` を入力
4. 自動的にプラグインがダウンロード・インストールされます

### 方法3: 手動インストール

1. [GitHub Releases](https://github.com/m0370/obsidian-LLM/releases) から最新リリースの以下3ファイルをダウンロード:
   - `main.js`
   - `styles.css`
   - `manifest.json`
2. Vaultの `.obsidian/plugins/obsidian-llm-assistant/` フォルダを作成
3. ダウンロードした3ファイルをこのフォルダに配置
4. Obsidianを再起動（またはリロード）
5. **設定** → **コミュニティプラグイン** で「LLM Assistant」を有効化

---

## アンインストール方法

### Obsidian設定画面から

1. **設定** → **コミュニティプラグイン** を開く
2. 「LLM Assistant」の右にあるトグルをオフにして**無効化**
3. プラグイン名をクリックして詳細を開き、**アンインストール** をクリック

### 手動削除

`.obsidian/plugins/obsidian-llm-assistant/` フォルダを削除し、Obsidianを再起動してください。

> 会話履歴データは `.obsidian/plugins/obsidian-llm-assistant/conversations/` に保存されています。プラグイン削除時に一緒に削除されます。

---

## 使い方

### 初期設定

1. **プラグインを有効化**後、左サイドバーのリボンアイコン（吹き出しマーク）をクリック、またはコマンドパレットから「LLM Assistant: チャットパネルを開く」を実行
2. 右サイドパネルにチャット画面が表示されます
3. **設定画面を開く**（チャットヘッダーの⚙ボタン、またはObsidian設定 → LLM Assistant）
4. 使用したいプロバイダーの**APIキー**を入力
5. 「テスト」ボタンでAPIキーの有効性を確認

### チャットの基本操作

1. チャットヘッダーのドロップダウンで**プロバイダーとモデル**を選択
2. 画面下部のテキストエリアにメッセージを入力
3. `Enter` キーまたは ▶ ボタンで送信（`Shift + Enter` で改行）
4. アシスタントの応答がストリーミング表示されます（Markdown形式でレンダリング）
5. 「+」ボタンで新規チャットを開始（現在の会話は自動保存されます）

### ノートの添付

Vault内のノートをコンテキストとしてLLMに送信できます。

- **📎 ボタン** — 現在アクティブなノートを添付
- **📁 ボタン** — ファイルピッカーからノートを選択して添付

添付されたノートはコンテキストバーに表示され、トークン数も確認できます。×ボタンで個別に削除できます。

### ツールバーのその他のボタン

- **📋 コピー** — アシスタントの最新の応答をクリップボードにコピー
- **📝 ノートに挿入** — アシスタントの応答をアクティブノートのカーソル位置に挿入

### クイックアクション

エディタでテキストを選択し、右クリック（モバイルでは長押し）メニューから以下のアクションを実行できます:

| アクション | 説明 |
|:---|:---|
| LLM: 要約する | 選択テキストを簡潔に要約 |
| LLM: 英語に翻訳 | 英語に翻訳 |
| LLM: 日本語に翻訳 | 日本語に翻訳 |
| LLM: 校正する | 文法・表現を校正し修正点を説明 |
| LLM: 解説する | わかりやすく解説 |
| LLM: 詳しく書く | テキストをより詳しく展開 |

選択テキストがプロンプトに追加され、チャットパネルに送信されます。

### 会話履歴

- チャットヘッダーの📖ボタンで**会話履歴一覧**を表示
- 過去の会話をクリックして再開
- ×ボタンで不要な会話を削除
- 新しいメッセージを送信すると自動的に保存されます

### システムプロンプトプリセット

設定画面の「プリセット」ドロップダウンから、用途に応じたシステムプロンプトを選択できます:

| プリセット名 | 用途 |
|:---|:---|
| デフォルト | プリセットなし |
| 丁寧な日本語アシスタント | 日本語で丁寧に回答 |
| テクニカルライター | 技術文書の執筆支援 |
| クリエイティブライター | 創造的な文章作成支援 |
| 翻訳者 | プロの翻訳（ニュアンス保持） |
| コードレビュアー | コード品質・セキュリティレビュー |

プリセットを選択するとシステムプロンプト欄に自動入力されます。カスタマイズも可能です。

---

## 設定項目一覧

| カテゴリ | 設定項目 | 説明 |
|:---|:---|:---|
| **LLM** | プロバイダー | 使用するLLMプロバイダーを選択 |
| | モデル | 使用するモデルを選択 |
| **セキュリティ** | API鍵の保存方式 | SecretStorage（推奨）/ WebCrypto暗号化 / 平文 |
| | マスターパスワード | WebCrypto選択時のみ表示。セッション中のみ保持 |
| **APIキー** | 各プロバイダーのAPIキー | テスト・削除ボタン付き |
| **カスタムエンドポイント** | エンドポイントURL | OpenAI互換APIのURL |
| | モデルID | 使用するモデルの識別子 |
| **詳細設定** | ストリーミングモード | レスポンスのリアルタイム表示（オン/オフ） |
| | Temperature | 生成の創造性（0.0〜1.0） |
| | プリセット | システムプロンプトのテンプレート選択 |
| | システムプロンプト | LLMへのデフォルト指示（自由記述） |

---

## セキュリティについて

API鍵の保管方法は3段階から選択できます:

| レベル | 方式 | 説明 |
|:---|:---|:---|
| **推奨** | SecretStorage API | OSレベルのセキュアストレージ（macOS Keychain等）を利用。Obsidian v1.11.4以上で利用可能 |
| **代替** | WebCrypto暗号化 | PBKDF2（10万回反復）+ AES-256-GCMで暗号化。マスターパスワードが必要（セッション中のみ保持） |
| **非推奨** | 平文保存 | プラグインデータに暗号化なしで保存。開発・テスト用途向け（警告表示あり） |

---

## Web公開（コミュニティプラグイン登録）の手順

Obsidianプラグインをコミュニティプラグインとして公開する方法を説明します。

### 前提条件

- GitHubにパブリックリポジトリとしてソースコードが公開されていること
- リポジトリに以下のファイルが含まれていること:
  - `README.md`（このファイル）
  - `LICENSE`（MITライセンス等）
  - `manifest.json`
  - `versions.json`

### Step 1: GitHub Releaseの作成

1. プラグインをビルドする
   ```bash
   npm run build
   ```
2. GitHubリポジトリの **Releases** ページを開く
3. **Draft a new release** をクリック
4. タグに `0.1.0` を入力（`manifest.json` の `version` と**完全に一致**させること。`v0.1.0` ではなく `0.1.0`）
5. リリースタイトルを入力（例: 「LLM Assistant 0.1.0」）
6. 以下の3ファイルを**バイナリとして添付**:
   - `main.js`
   - `styles.css`
   - `manifest.json`
7. **Publish release** をクリック（ドラフトやプレリリースではなく正式リリースとして公開）

### Step 2: obsidian-releases リポジトリへのPR作成

1. [obsidian-releases](https://github.com/obsidianmd/obsidian-releases) リポジトリをフォーク
2. `community-plugins.json` ファイルに以下のエントリを追加:
   ```json
   {
       "id": "obsidian-llm-assistant",
       "name": "LLM Assistant",
       "author": "m0370",
       "description": "LLM-powered writing assistant with mobile-first design. Supports Claude, GPT, and Gemini.",
       "repo": "m0370/obsidian-LLM"
   }
   ```
3. Pull Requestを作成
4. 自動バリデーション（JSON形式チェック、リポジトリ存在確認等）が実行される
5. Obsidianチームのレビュー後、承認されるとコミュニティプラグインブラウザに掲載

### 代替: BRATプラグイン経由の配布

コミュニティプラグイン審査を待たずにプラグインを配布する場合は、Step 1のGitHub Releaseを作成するだけで準備完了です。ユーザーに以下の手順を案内してください:

1. [BRAT](https://github.com/TfTHacker/obsidian42-brat) プラグインをインストール
2. コマンドパレットから「BRAT: Add a beta plugin for testing」を実行
3. `m0370/obsidian-LLM` を入力

---

## 開発

### ビルド

```bash
npm install
npm run build
```

### 開発モード（ファイル監視）

```bash
npm run dev
```

### テスト

```bash
npm test
```

### モバイル互換性チェック

```bash
npm run check-mobile
```

---

## ライセンス

[MIT License](LICENSE)
